{% extends "layout_template.html" %}
{% from "../macros/formElements.html" import dropdown %}
{% from "../macros/formElements.html" import dateMacro %}
{% from "../macros/csrf.html" import csrfProtection %}
{% block page_title %}
  CCD Admin Web
{% endblock %}
{% block head%}
  {{super()}}

  <script type="text/javascript">
  var jurisdictionString = {{jurisdictions |safe }}
  var jurisdictionLookups = $.parseJSON(jurisdictionString);
  
  var updateCaseTypeBasedOn = function(index) {

    var listItems= "<option value=''  selected>--Select a value--</option>";
    if(index > -1){
        var case_types = jurisdictionLookups[index].case_types;
        for (var i = 0; i < jurisdictionLookups[index].case_types.length; i++){
            listItems+= "<option value='" + case_types[i].id + "'>" + case_types[i].name + "</option>";
        }
    }
    $("select#caseTypeDropdown").html(listItems);
    $("select#stateDropdown").html("<option value=''  selected>--Select a value--</option>");
  }

  $(document).ready(function(){
     $('#createuserform').validate({ // initialize the plugin
        onkeyup: false,
        onclick: false,
        onfocusout: false,
       errorPlacement: function (error, element) {
            error.insertBefore(element);
        },
        errorElement : 'div',
        errorElementClass: 'error',
        errorClass: 'govuk-error-message form-group-error',
        rules: {
            idamsId: {
                required: true,
                email: true
            },
            jurisdictionDropdown: {
                required: true
            },
            caseTypeDropdown: {
                required: true
            },
            stateDropdown: {
                required: true
            }
        },
        messages :{
            "idamsId" : {
                required : 'Enter Idams Id',
                email: 'Email address invalid'
            },
            "jurisdictionDropdown": {
                required : 'Choose a jurisdiction'
            },
            "caseTypeDropdown": {
                required : 'Choose a case type'
            },
            "stateDropdown": {
                required : 'Choose a state'
            }
        }
    });


    var listItems= "<option value='' selected>--Select a value--</option>";
    for (var i = 0; i < jurisdictionLookups.length; i++){
        listItems+= "<option value='" + jurisdictionLookups[i].id + "'>" + jurisdictionLookups[i].name + "</option>";
    }
    $("select#jurisdictionDropdown").html(listItems);
    $("select#jurisdictionDropdown").on('change',function(){
        var str = "";
        $( "select#jurisdictionDropdown option:selected" ).each(function() {
            updateCaseTypeBasedOn($("select#jurisdictionDropdown")[0].selectedIndex -1);
      
        });
     });
      $("select#caseTypeDropdown").on('change',function(){
       var jurisdictionIndex = $("select#jurisdictionDropdown")[0].selectedIndex -1;
       var caseTypeIndex = $("select#caseTypeDropdown")[0].selectedIndex -1;
        var listItems= "<option value='' selected>--Select a value--</option>";
        if(caseTypeIndex > -1){
            var stateTypes = jurisdictionLookups[jurisdictionIndex].case_types[caseTypeIndex].states;
 
            for (var i = 0; i < stateTypes.length; i++){
            listItems+= "<option value='" + stateTypes[i].id + "'>" + stateTypes[i].name + "</option>";
            }
        }
         $("select#stateDropdown").html(listItems);
      });
  });

</script>
{%endblock%}
 {% block content %}
 {% include "menu.html" %}
<h2 class="heading-large padding">Create User profile</h2>

<div class="padding">
    {% if (error)%}
        <div class="error-summary govuk-error-message">
            {{error.text}}
        </div>
    {% endif %}

    <form id="createuserform" name="createuserform" method="POST">
    
      {{ csrfProtection(csrfToken) }}
        <div class="form-group">
        
            <label class="form-label" for="first-name-2">User Idams ID</label>
            <input class="form-control" id="idamsId" name="idamsId" type="text"><br><br>  
        <label class="form-label">Live from</label>
            {{ dateMacro() }}
            <label class="form-label">Live to</label>
            {{ dateMacro() }}
            <label class="form-label" >Work basket default jurisdiction</label>
            {{  dropdown("jurisdictionDropdown") }}
            <label class="form-label">Work basket default case type</label>
            {{   dropdown("caseTypeDropdown") }}
            <label class="form-label">Work basket default state</label>
            {{  dropdown("stateDropdown")}}
        </div> 
        <button type="submit" class="button" value="Submit">Create</button>
    </form>
    </div>
  
  {% endblock %}


